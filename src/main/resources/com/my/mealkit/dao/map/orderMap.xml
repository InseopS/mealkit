<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
   'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>
<mapper namespace='com.my.mealkit.dao.map.OrderMap'>
   <select id='selectOrders' resultType='order'>
	  select orders.order_num, order_status.order_status_name, 
	      mealkits.mealkit_name, mealkits.mealkit_img_file_name,mealkits.price,
	      orders_mealkits.order_mealkit_count
	  from orders inner join orders_mealkits
	  on orders.order_num = orders_mealkits.order_num
	  inner join mealkits
	  on orders_mealkits.mealkit_num = mealkits.mealkit_num
      inner join order_status
      on orders.order_status_code = order_status.order_status_code
	  where orders.user_id = #{userId}
	  order by order_num
   </select>
   
   <select id='detailOrders' resultType='order'>
      select orders.order_num, orders.order_date, orders.request, order_status.order_status_name, payments.payment_name,
	      users.user_name, users.phone_num, users.zip_code, users.basic_address, users.detail_address,
	      mealkits.mealkit_name, mealkits.price, mealkits.mealkit_img_file_name, 
	      orders_mealkits.order_mealkit_count
	  from orders inner join users
	  on orders.user_id = users.user_id
	  inner join orders_mealkits
	  on orders_mealkits.order_num = orders.order_num
	  inner join mealkits
	  on orders_mealkits.mealkit_num = mealkits.mealkit_num
      inner join order_status
      on orders.order_status_code = order_status.order_status_code
      inner join payments
      on orders.payment_code = payments.payment_code
	  where orders.order_num = #{orderNum}
	  order by order_mealkit_num
   </select>
   
   <select id='selectAdminOrders' resultType='order'>
      select orders.order_num, users.user_id,
		    mealkits.mealkit_name, mealkits.price,
		    orders_mealkits.order_mealkit_num,
		    payments.payment_name, order_status.order_status_name
	  from orders inner join users
	  on orders.user_id = users.user_id
	  inner join orders_mealkits
	  on orders_mealkits.order_num = orders.order_num
	  inner join mealkits
	  on orders_mealkits.mealkit_num = mealkits.mealkit_num
      inner join payments
      on payments.payment_code = orders.payment_code
      inner join order_status
      on orders.order_status_code = order_status.order_status_code
	  order by order_num
   </select>
   
   <select id='selectMealkitNames' resultType='order'>
	  select mealkits.mealkit_name
	  from orders inner join orders_mealkits
	  on orders_mealkits.order_num = orders.order_num
	  inner join mealkits
	  on mealkits.mealkit_num = orders_mealkits.mealkit_num
	  where orders.order_num = #{orderNum}
   </select>
   
   <insert id='insertOrder'>
      insert into orders(order_num, order_date, request, user_id,
         payment_code, order_status_code)
      values(order_num_seq.nextval, #{orderDate}, #{request}, #{userId},
         #{paymentCode}, #{orderStatusCode})      
   </insert>
   
   <delete id='deleteOrder'>
      delete orders
      where order_num = #{orderNum}
   </delete>
</mapper>